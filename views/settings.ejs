<!DOCTYPE html>
<html>
  <head>
    <%- include("./parts/head.ejs") %>
  </head>
  <body>
    
    <div class="ta-center">
      
      <% if (error) { %>
    <div class="error">
      <span class="error-msg"><%= msg %></span>
    </div>      
      <% } %>
      
    <div class="box-1 cv">
<form method="post">
  <h1 style="color: #ddd; text-align: center;">
    Hi <%= req.session.user.Username %>!
  </h1>
  
  <div class="form-control">
    <label for="username-input">Username</label>
    <input name="username" type="text" class="form-input" id="username-input" value="<%= req.session.user.Username %>" required>
  </div>  
  <div class="form-control">
    <label for="email-input">Email</label>
    <input type="email" class="form-input" id="email-input" aria-describedby="email-help" value="<%= req.session.user.Email %>" disabled>
    <input name="email" value="<%= req.session.user.Email %>" type="hidden">
  </div>
<!--  type="button"  -->
  <div class="form-control" onclick="showPass()">
    <label for="password-input" onclick="showPass()">Password (click to show/hide)</label>
    <input name="password" type="password" class="form-input" id="password-input" value="<%= req.session.user.Password %>" required>
  </div>
  <div class="form-control">
    <label for="avatar-input">Avatar</label>
    <input name="avatar" type="url" class="form-input" id="avatar-input" value="<%= req.session.user.Avatar %>" required>
  </div> 
  <div class="form-control">
    <label for="wallpaper-input">Custom wallpaper <a href="#" onclick="removeWallpaper()">remove</a></label>
    <input name="wallpaper" type="url" class="form-input" id="wallpaper-input" value="<%= req.session.user.Wallpaper ? req.session.user.Wallpaper : "" %>">
  </div>   
<!--   <div class="form-control" onclick="copyURL()">
    <label for="url-input">Your URL</label>
    <input type="url" class="form-input" id="url-input" aria-describedby="url-help" value="add me on https://zhat.cf with code: <%= req.session.user.UID %>" disabled>
    <input name="url" value="add me on https://zhat.cf with code: <%= req.session.user.UID %>" type="hidden">
  </div> -->
  <div class="form-control" style="margin-bottom: 10px;">
    <button type="button" class="btn btn-primary" onclick="navigator.clipboard.writeText('<%= req.session.user.UID %>');">
      copy your uid
    </button>
  </div>  
  <div class="form-control" style="margin-bottom: 10px;">
    <a type="button" style="text-align: center;" class="btn btn-primary share-btn" href="https://www.addtoany.com/share_save?linkurl=https://zhat.cf/invite/<%= req.session.user.UID %>" onclick="copyURL()">
      share your account
    </a>
  </div>
  
  <div class="btn-submit">
    <a style="margin-right: 10px;" href="/">back</a><a style="margin-right: 10px;" href="/logout">logout</a><button type="submit" class="btn btn-primary">Save</button>    
  </div>
</form>
    </div>
    </div>
    
    <script src="https://cdn.socket.io/4.1.2/socket.io.min.js" integrity="sha384-toS6mmwu70G0fw54EGlWWeA4z3dyJ+dlXBtSURSKN4vyRFOcxd3Bzjj/AoOwY+Rg" crossorigin="anonymous">
    </script>
    <script>
    let socket = io();
      
      console.log("connected")
      socket.emit("isConnected", '<%= req.session.user.UID %>')
                  
      socket.on("someoneOnline", userId => {
        let user = document.getElementById(userId);
        if (!user) return;
      
        
        user.classList.remove("offline")
        user.classList.add("online")
        user.innerHTML = '<i class="fa fa-check"></i> online'  
      })
      
      socket.on("newMessage", (opt) => {
        let user = document.getElementById(`${opt.id}-lastmsg`);
        if (opt.to !== '<%= req.session.user.UID %>') return;
        if (!user) return;
        
        user.innerHTML = `${opt.id == '<%= req.session.user.UID %>' ? '(you):' : '(new messages):'} ${opt.msg}`;
      })
                  
      socket.on("isOnline", userId => {
        socket.emit("updateOnline", '<%= req.session.user.UID %>')
        let user = document.getElementById(userId);
        if (!user) return;
        console.log(`${userId} is online`)
        
        user.classList.remove("remove")
        user.classList.add("online")
        user.innerHTML = '<i class="fa fa-check"></i> online';
      });
      
      socket.on("isOffline", userId => {
        let user = document.getElementById(userId);
        if (!user) return;
        console.log(`${userId} is offline`)
        
        user.classList.remove("online")
        user.classList.add("offline")
        user.innerHTML = '<i class="fa fa-times"></i> offline';        
      })
      
    </script>    
    
    <script>
    let pass = document.getElementById('password-input');
      let type = false;
      
      function showPass() {
        if (type) {
          pass.type = "password"
          type = false;
        } else {
          type = true;
          pass.type = "text"
        }
      }
      
      function copyURL() {
        let url = '<%= req.session.user.UID %>'
        navigator.clipboard.writeText(`https://zhat.cf/invite/<%= req.session.user.UID %>`);
      }
      
      function removeWallpaper() {
        document.getElementById("wallpaper-input").value = ""
      }
      
(function(){
  
  var shareButtons = document.querySelectorAll(".share-btn");

  if (shareButtons) {
      [].forEach.call(shareButtons, function(button) {
      button.addEventListener("click", function(event) {
 				var width = 650,
            height = 450;

        event.preventDefault();

        window.open(this.href, 'Share Dialog', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,width='+width+',height='+height+',top='+(screen.height/2-height/2)+',left='+(screen.width/2-width/2));
      });
    });
  }

})();      
    </script>
  </body>
</html>