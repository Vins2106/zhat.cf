<!DOCTYPE html>
<html>
  <head>
    <%- include("./parts/head.ejs") %>
  </head>
  <body>
    
    <div class="ta-center">
      
      <% if (error) { %>
    <div class="error">
      <span class="error-msg"><%= msg %></span>
    </div>      
      <% } else if (success) { %>
      <div class="success">
        <span class="success-msg">Successfuly add</span>
      </div>
      <% } %>
      
    <div class="box-1 cv">
<form method="post">
  <h1 style="color: #ddd; text-align: center;">
    Hi <%= req.session.user.Username %>!
  </h1>
  
  <div class="form-control">
    <label for="user-input">Add someone with <a href="/faq#get-user-id" target="_blank">User ID</a></label>
    <% if (add) { %>
    <input name="user" type="text" class="form-input" id="user-input" placeholder="user id" value="<%= add %>" required>
    <% } else { %>
    <input name="user" type="text" class="form-input" id="user-input" placeholder="user id" required>
    <% } %>
  </div>    
  
  <div class="btn-submit">
    <a style="margin-right: 10px;" href="/">cancel</a><button type="submit" class="btn btn-primary">Add</button>    
  </div>
</form>
    </div>
    </div>
    
    <script src="https://cdn.socket.io/4.1.2/socket.io.min.js" integrity="sha384-toS6mmwu70G0fw54EGlWWeA4z3dyJ+dlXBtSURSKN4vyRFOcxd3Bzjj/AoOwY+Rg" crossorigin="anonymous">
    <script>
    let socket = io();
      
      console.log("connected")
      socket.emit("isConnected", '<%= req.session.user.UID %>')
                  
      socket.on("someoneOnline", userId => {
        let user = document.getElementById(userId);
        if (!user) return;
      
        
        user.classList.remove("offline")
        user.classList.add("online")
        user.innerHTML = '<i class="fa fa-check"></i> online'  
      })
      
      socket.on("newMessage", (opt) => {
        let user = document.getElementById(`${opt.id}-lastmsg`);
        if (opt.to !== '<%= req.session.user.UID %>') return;
        if (!user) return;
        
        user.innerHTML = `${opt.id == '<%= req.session.user.UID %>' ? '(you):' : '(new messages):'} ${opt.msg}`;
      })
                  
      socket.on("isOnline", userId => {
        socket.emit("updateOnline", '<%= req.session.user.UID %>')
        let user = document.getElementById(userId);
        if (!user) return;
        console.log(`${userId} is online`)
        
        user.classList.remove("remove")
        user.classList.add("online")
        user.innerHTML = '<i class="fa fa-check"></i> online';
      });
      
      socket.on("isOffline", userId => {
        let user = document.getElementById(userId);
        if (!user) return;
        console.log(`${userId} is offline`)
        
        user.classList.remove("online")
        user.classList.add("offline")
        user.innerHTML = '<i class="fa fa-times"></i> offline';        
      })
      
    </script>
  </body>
</html>